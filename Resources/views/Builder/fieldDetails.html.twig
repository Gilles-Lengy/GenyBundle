{# GenyBundle:Builder:fieldDetails.html.twig #}

{% import 'GenyBundle::macros.html.twig' as macros %}

{% set formId = entity.form.id %}
{% set fieldId = entity.id %}

{# Field details form #}

{%
    set ajax = {
        'class': 'domajax change',
        'data-endpoint': path('geny_builder_field_details', {formId: formId, fieldId: fieldId}),
        'data-input': '#geny-field-details-form-' ~ fieldId,
        'data-output-json': 'preview details default',
        'data-json-preview': '#geny-field-preview-' ~ fieldId,
        'data-json-details': '#geny-field-details-' ~ fieldId,
        'data-json-default': '#geny-field-default-' ~ fieldId,
    }
%}

<div class="well">

    <div id="geny-field-details-form-{{ fieldId }}">

        {{ form_start(form) }}

        <div class="form-group form-inline">

            {{
                form_row(form.name, {
                    attr: form.name.vars.attr|merge(ajax)
                })
            }}

            <div class="pull-right">

                {{
                    form_row(form.required, {
                        attr: form.required.vars.attr|merge(ajax)
                    })
                }}

            </div>
        </div>

        {{
            form_row(form.label, {
                attr: form.label.vars.attr|merge(ajax)
            })
        }}

        {{
            form_row(form.help, {
                attr: form.help.vars.attr|merge(ajax)
            })
        }}

        {{ form_end(form) }}

    </div>

    {# Default value button #}

    <button class="btn btn-default" data-toggle="modal" data-target="#geny-default-modal-{{ fieldId }}">
        <span class="glyphicon glyphicon-pencil"></span> {{ 'geny.view.field_default.button' | trans({}, 'geny') }}
    </button>

    {% set body %}
        <div id="geny-field-default-{{ fieldId }}" class="text-left">
            {{ render(controller('GenyBundle:Builder:fieldDefault', {formId: formId, fieldId: fieldId})) }}
        </div>
    {% endset %}

    {% set footer %}
        <button
            type="button"
            class="btn btn-primary domajax click"
            data-endpoint="{{ path('geny_builder_field_default', {formId: formId, fieldId: fieldId}) }}"
            data-input="#geny-field-default-{{ fieldId }}"
            data-output-json="preview default"
            data-json-preview="#geny-field-preview-{{ fieldId }}"
            data-json-default="#geny-field-default-{{ fieldId }}"
            data-dismiss="modal"
            title="{{ 'geny.view.field_default.save.title' | trans({}, 'geny') }}">{{ 'geny.view.field_default.save.value' | trans({}, 'geny') }}</button>
    {% endset %}

    {{
        macros.modal(
            'geny-default-modal-' ~ fieldId,
            'geny.view.field_default.title' | trans({'%name%': entity.name}, 'geny'),
            body,
            footer
        )
    }}

    {# Options button #}

    <button class="btn btn-default" data-toggle="modal" data-target="#geny-options-modal-{{ fieldId }}">
        <span class="glyphicon glyphicon-cog"></span> {{ 'geny.view.field_options.button' | trans({}, 'geny') }}
    </button>

    {% set body %}
        <div id="geny-field-options-{{ fieldId }}" class="text-left">
            {{ render(controller('GenyBundle:Builder:fieldOptions', {formId: formId, fieldId: fieldId})) }}
        </div>
    {% endset %}

    {% set footer %}
        <button
            type="button"
            class="btn btn-primary domajax click"
            data-endpoint="{{ path('geny_builder_field_options', {formId: formId, fieldId: fieldId}) }}"
            data-input="#geny-field-options-{{ fieldId }}"
            data-output-json="preview default"
            data-json-preview="#geny-field-preview-{{ fieldId }}"
            data-json-default="#geny-field-default-{{ fieldId }}"
            data-dismiss="modal"
            title="{{ 'geny.view.field_options.save.title' | trans({}, 'geny') }}">{{ 'geny.view.field_options.save.value' | trans({}, 'geny') }}</button>
    {% endset %}

    {{
        macros.modal(
            'geny-options-modal-' ~ fieldId,
            'geny.view.field_options.title' | trans({'%name%': entity.name}, 'geny'),
            body,
            footer
        )
    }}


    {# Validation button #}

    <span id="geny-field-validation-container-{{ fieldId }}">
        {{ render(controller('GenyBundle:Builder:fieldValidation', {formId: formId, fieldId: fieldId})) }}
    </span>

</div>
